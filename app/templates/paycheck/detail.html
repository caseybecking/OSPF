{% extends "partials/base.html" %}
{% block title %}Paycheck Details{% endblock title %}
{% block extra_css %}
<style>
.info-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}
.section-title {
    font-weight: 600;
    color: #495057;
    margin-bottom: 15px;
    border-bottom: 2px solid #dee2e6;
    padding-bottom: 8px;
}
.stat-card {
    background: white;
    border-radius: 8px;
    padding: 15px;
    border-left: 4px solid #007bff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.percentage-display {
    font-size: 1.2em;
    font-weight: 600;
}
</style>
{% endblock extra_css %}
{% block content %}
<div class="main-content">
    <div class="page-content">
        <div class="container-fluid">

            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between bg-galaxy-transparent">
                        <h4 class="mb-sm-0">Paycheck Details</h4>

                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="{{ url_for('dashboards.index') }}">Dashboard</a></li>
                                <li class="breadcrumb-item"><a href="{{ url_for('paychecks.index') }}">Paychecks</a></li>
                                <li class="breadcrumb-item active">Details</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end page title -->

            <!-- Action buttons -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="d-flex justify-content-end gap-2">
                        <a href="{{ url_for('paychecks.edit', paycheck_id=paycheck.id) }}" class="btn btn-primary">
                            <i class="ri-edit-line"></i> Edit Paycheck
                        </a>
                        <form method="POST" action="{{ url_for('paychecks.delete', paycheck_id=paycheck.id) }}" style="display: inline;" 
                              onsubmit="return confirm('Are you sure you want to delete this paycheck?')">
                            <button type="submit" class="btn btn-danger">
                                <i class="ri-delete-bin-line"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Basic Information -->
            <div class="info-section">
                <h6 class="section-title">Basic Information</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Employer</h6>
                                    <h4 class="mb-0">{{ paycheck.employer }}</h4>
                                    <small class="text-muted">Employee: {{ paycheck.employee_name }}</small>
                                </div>
                                <i class="ri-building-line display-6 text-primary"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Pay Date</h6>
                                    <h4 class="mb-0">{{ paycheck.pay_date.strftime('%B %d, %Y') }}</h4>
                                </div>
                                <i class="ri-calendar-line display-6 text-success"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Pay Period</h6>
                                    <h5 class="mb-0">{{ paycheck.pay_period_start.strftime('%m/%d/%Y') }} - {{ paycheck.pay_period_end.strftime('%m/%d/%Y') }}</h5>
                                </div>
                                <i class="ri-time-line display-6 text-info"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Period Length</h6>
                                    <h5 class="mb-0">{{ (paycheck.pay_period_end - paycheck.pay_period_start).days + 1 }} days</h5>
                                </div>
                                <i class="ri-hourglass-line display-6 text-warning"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Income Summary -->
            <div class="info-section">
                <h6 class="section-title">Income Summary</h6>
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <div class="stat-card mb-3 border-start-success">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Gross Income</h6>
                                    <h3 class="mb-0 text-success">${{ "%.2f"|format(paycheck.gross_income) }}</h3>
                                </div>
                                <i class="ri-money-dollar-circle-line display-5 text-success"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="stat-card mb-3 border-start-info">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Net Pay 
                                        {% if paycheck.net_pay_matches %}
                                            <span class="badge bg-success ms-1">âœ“</span>
                                        {% else %}
                                            <span class="badge bg-warning ms-1">!</span>
                                        {% endif %}
                                    </h6>
                                    <h3 class="mb-0 text-info">${{ "%.2f"|format(paycheck.net_pay) }}</h3>
                                    {% if not paycheck.net_pay_matches %}
                                        <small class="text-muted">Calculated: ${{ "%.2f"|format(paycheck.calculated_net_pay) }}</small>
                                    {% endif %}
                                </div>
                                <i class="ri-wallet-line display-5 text-info"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="stat-card mb-3 border-start-secondary">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Taxable Income</h6>
                                    <h3 class="mb-0 text-secondary">${{ "%.2f"|format(paycheck.taxable_income) }}</h3>
                                </div>
                                <i class="ri-calculator-line display-5 text-secondary"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="stat-card mb-3 border-start-warning">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Total Deductions</h6>
                                    <h3 class="mb-0 text-warning">${{ "%.2f"|format(paycheck.total_deductions) }}</h3>
                                </div>
                                <i class="ri-subtract-line display-5 text-warning"></i>
                            </div>
                        </div>
                    </div>
                </div>

                {% if paycheck.bonus > 0 or paycheck.commission > 0 %}
                <div class="row">
                    {% if paycheck.bonus > 0 %}
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Bonus</h6>
                                    <h4 class="mb-0 text-success">${{ "%.2f"|format(paycheck.bonus) }}</h4>
                                </div>
                                <i class="ri-gift-line display-6 text-success"></i>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.commission > 0 %}
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Commission</h6>
                                    <h4 class="mb-0 text-success">${{ "%.2f"|format(paycheck.commission) }}</h4>
                                </div>
                                <i class="ri-trophy-line display-6 text-success"></i>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <!-- Percentages Overview -->
            <div class="info-section">
                <h6 class="section-title">Percentage Breakdown</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Effective Tax Rate</h6>
                                    <div class="percentage-display text-warning">{{ "%.1f"|format(paycheck.effective_tax_rate) }}%</div>
                                </div>
                                <i class="ri-percent-line display-6 text-warning"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Retirement Contribution Rate</h6>
                                    <div class="percentage-display text-info">{{ "%.1f"|format(paycheck.retirement_contribution_rate) }}%</div>
                                </div>
                                <i class="ri-percent-line display-6 text-info"></i>
                            </div>
                        </div>
                    </div>
                    {% if paycheck.federal_tax > 0 %}
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">Federal Tax Rate</h6>
                                    <div class="percentage-display text-danger">{{ "%.1f"|format(paycheck.federal_tax_rate) }}%</div>
                                </div>
                                <i class="ri-percent-line display-6 text-danger"></i>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.state_tax > 0 %}
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-muted mb-0">State Tax Rate</h6>
                                    <div class="percentage-display text-danger">{{ "%.1f"|format(paycheck.state_tax_rate) }}%</div>
                                </div>
                                <i class="ri-percent-line display-6 text-danger"></i>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Tax Breakdown -->
            {% if paycheck.total_taxes > 0 %}
            <div class="info-section">
                <h6 class="section-title">Tax Breakdown</h6>
                <div class="row">
                    {% if paycheck.federal_tax > 0 %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Federal Tax</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.federal_tax) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.state_tax > 0 %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">State Tax</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.state_tax) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.social_security_tax > 0 %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Social Security</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.social_security_tax) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.medicare_tax > 0 %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Medicare</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.medicare_tax) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.other_taxes > 0 %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Other Taxes</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.other_taxes) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Insurance & Retirement -->
            {% if (paycheck.health_insurance + paycheck.dental_insurance + paycheck.vision_insurance + paycheck.voluntary_life_insurance + paycheck.total_retirement) > 0 %}
            <div class="row">
                <!-- Insurance Deductions -->
                {% if (paycheck.health_insurance + paycheck.dental_insurance + paycheck.vision_insurance + paycheck.voluntary_life_insurance) > 0 %}
                <div class="col-md-6">
                    <div class="info-section">
                        <h6 class="section-title">Insurance Deductions</h6>
                        {% if paycheck.health_insurance > 0 %}
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Health Insurance</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.health_insurance) }}</h5>
                        </div>
                        {% endif %}
                        {% if paycheck.dental_insurance > 0 %}
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Dental Insurance</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.dental_insurance) }}</h5>
                        </div>
                        {% endif %}
                        {% if paycheck.vision_insurance > 0 %}
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Vision Insurance</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.vision_insurance) }}</h5>
                        </div>
                        {% endif %}
                        {% if paycheck.voluntary_life_insurance > 0 %}
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Voluntary Life Insurance</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.voluntary_life_insurance) }}</h5>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Retirement Contributions -->
                {% if paycheck.total_retirement > 0 %}
                <div class="col-md-6">
                    <div class="info-section">
                        <h6 class="section-title">Retirement Contributions</h6>
                        {% if paycheck.retirement_401k > 0 %}
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">401(k)</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.retirement_401k) }}</h5>
                        </div>
                        {% endif %}
                        {% if paycheck.retirement_403b > 0 %}
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">403(b)</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.retirement_403b) }}</h5>
                        </div>
                        {% endif %}
                        {% if paycheck.retirement_ira > 0 %}
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">IRA</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.retirement_ira) }}</h5>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Work Details -->
            {% if paycheck.hours_worked or paycheck.hourly_rate or paycheck.overtime_hours > 0 %}
            <div class="info-section">
                <h6 class="section-title">Work Details</h6>
                <div class="row">
                    {% if paycheck.hours_worked %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Hours Worked</h6>
                            <h5 class="mb-0">{{ "%.1f"|format(paycheck.hours_worked) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.hourly_rate %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Hourly Rate</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.hourly_rate) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.overtime_hours > 0 %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Overtime Hours</h6>
                            <h5 class="mb-0">{{ "%.1f"|format(paycheck.overtime_hours) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                    {% if paycheck.overtime_rate %}
                    <div class="col-lg-3 col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Overtime Rate</h6>
                            <h5 class="mb-0">${{ "%.2f"|format(paycheck.overtime_rate) }}</h5>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Other Deductions & Notes -->
            {% if paycheck.other_deductions > 0 or paycheck.notes %}
            <div class="info-section">
                <h6 class="section-title">Additional Information</h6>
                {% if paycheck.other_deductions > 0 %}
                <div class="stat-card mb-3">
                    <h6 class="text-muted mb-1">Other Deductions</h6>
                    <h5 class="mb-0">${{ "%.2f"|format(paycheck.other_deductions) }}</h5>
                </div>
                {% endif %}
                {% if paycheck.notes %}
                <div class="stat-card mb-3">
                    <h6 class="text-muted mb-2">Notes</h6>
                    <p class="mb-0">{{ paycheck.notes }}</p>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Audit Information -->
            <div class="info-section">
                <h6 class="section-title">Record Information</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Created</h6>
                            <p class="mb-0">{{ paycheck.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stat-card mb-3">
                            <h6 class="text-muted mb-1">Last Updated</h6>
                            <p class="mb-0">{{ paycheck.updated_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock content %}